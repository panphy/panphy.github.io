<!DOCTYPE html>
<html lang="en" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wave Superposition Simulation</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .catch((err) => console.log('Service Worker registration failed', err));
            });
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;600&family=Poppins:wght@600;700;800&display=swap');

        :root {
            --font-sans: 'Inter', sans-serif;
            --font-display: 'Poppins', 'Inter', sans-serif;
            --font-mono: 'JetBrains Mono', monospace;

            /* Light Theme */
            --bg-color: #f8f9fa;
            --bg-pattern: #e9ecef;
            --text-main: #2d3436;
            --text-secondary: #636e72;

            --brand-primary: #6c5ce7;
            --brand-secondary: #a29bfe;
            --brand-accent: #00cec9;

            --card-bg: #ffffff;
            --card-border: #e9ecef;
            --card-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);

            --canvas-bg: #ffffff;
            --canvas-baseline: #cbd5e1;

            --btn-bg: #6c5ce7;
            --btn-text: #ffffff;
            --btn-hover: #5b4cdb;

            --slider-track: #e2e8f0;
            --slider-thumb: #6c5ce7;

            --switch-off: #cbd5e1;
            --switch-on: #6c5ce7;

            --header-bg: rgba(255, 255, 255, 0.9);
            --header-border: rgba(108, 92, 231, 0.1);

            --nav-bg: rgba(255, 255, 255, 0.85);
            --nav-border: rgba(255, 255, 255, 0.5);
        }

        [data-theme="dark"] {
            --bg-color: #0f1014;
            --bg-pattern: #181a20;
            --text-main: #dfe6e9;
            --text-secondary: #b2bec3;

            --brand-primary: #a29bfe;
            --brand-secondary: #6c5ce7;
            --brand-accent: #81ecec;

            --card-bg: #1e2129;
            --card-border: #2d3436;
            --card-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);

            --canvas-bg: #16181d;
            --canvas-baseline: #4a5568;

            --btn-bg: #6c5ce7;
            --btn-text: #ffffff;
            --btn-hover: #7c6ef0;

            --slider-track: #4a5568;
            --slider-thumb: #a29bfe;

            --switch-off: #4a5568;
            --switch-on: #a29bfe;

            --header-bg: rgba(30, 33, 41, 0.95);
            --header-border: rgba(162, 155, 254, 0.1);

            --nav-bg: rgba(22, 24, 29, 0.85);
            --nav-border: rgba(255, 255, 255, 0.08);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }

        .offline-font {
            --font-sans: 'Inter', 'Poppins', sans-serif;
            --font-display: 'Poppins', 'Inter', sans-serif;
            --font-mono: 'JetBrains Mono', monospace;
        }

        body {
            font-family: var(--font-sans);
            background-color: var(--bg-color);
            background-image: radial-gradient(var(--bg-pattern) 1px, transparent 1px);
            background-size: 30px 30px;
            color: var(--text-main);
            min-height: 100vh;
            padding: 0;
        }

        /* Compact Header */
        header.banner {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
            padding: 8px 20px;
            margin: 16px auto 0;
            width: min(1100px, calc(100% - 40px));
            background: var(--nav-bg);
            border: 1px solid var(--nav-border);
            border-radius: 20px;
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .banner-logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .banner-logo img {
            height: 36px;
            width: auto;
            filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.1));
        }

        .banner-title {
            font-family: var(--font-display);
            font-size: 1.6rem;
            font-weight: 800;
            text-align: center;
            flex: 1;
            letter-spacing: -0.5px;
            background: linear-gradient(135deg, var(--brand-primary), var(--brand-accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .banner-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .theme-toggle button {
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 0.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-main);
        }

        .theme-toggle button:hover {
            background-color: rgba(128, 128, 128, 0.2);
            transform: rotate(15deg);
        }

        /* Main Content */
        .main-content {
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .instructions {
            font-size: 0.9rem;
            color: var(--text-secondary);
            text-align: center;
            margin-bottom: 20px;
        }

        #mainWrapper {
            display: flex;
            gap: 20px;
            width: 100%;
        }

        /* Canvas Container */
        #canvasContainer {
            flex: 3;
            background: var(--card-bg);
            padding: 20px;
            border-radius: 16px;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--card-border);
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        #zoomMotionControls {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .zoomMotion-group {
            flex: 1 1 200px;
            display: flex;
            flex-direction: column;
        }

        .zoomMotion-group label {
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--text-main);
        }

        #waveCanvas {
            width: 100%;
            height: 400px;
            border-radius: 12px;
            background-color: var(--canvas-bg);
            border: 1px solid var(--card-border);
        }

        #playPauseBtn {
            width: 120px;
            height: 44px;
            margin: 0 auto;
            font-size: 1rem;
            cursor: pointer;
            border: none;
            border-radius: 12px;
            background: var(--btn-bg);
            color: var(--btn-text);
            font-weight: 600;
            transition: background-color 0.2s, transform 0.2s;
        }

        #playPauseBtn:hover {
            background: var(--btn-hover);
            transform: translateY(-2px);
        }

        #note {
            text-align: center;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        /* Side Controls */
        #sideControls {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 16px;
            min-width: 280px;
        }

        .wave-controls,
        .toggle-controls {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 16px;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--card-border);
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .wave-controls h3,
        .toggle-controls h3 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--brand-primary);
            text-align: center;
            margin-bottom: 5px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
        }

        .control-group label {
            margin-bottom: 6px;
            font-weight: 500;
            font-size: 0.9rem;
            color: var(--text-main);
        }

        .control-group input[type=range] {
            width: 100%;
            cursor: pointer;
        }

        /* Range Slider Styling */
        input[type=range] {
            -webkit-appearance: none;
            appearance: none;
            height: 6px;
            border-radius: 5px;
            background: transparent;
            outline: none;
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 6px;
            border-radius: 5px;
            background: var(--slider-track);
        }

        input[type=range]::-moz-range-track {
            width: 100%;
            height: 6px;
            border-radius: 5px;
            background: var(--slider-track);
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--slider-thumb);
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
            margin-top: -6px;
        }

        input[type=range]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--slider-thumb);
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }

        /* Toggle Switch Styles */
        .toggle-group {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .toggle-group label {
            font-weight: 500;
            font-size: 0.9rem;
            color: var(--text-main);
            cursor: pointer;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 48px;
            height: 26px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider-switch {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--switch-off);
            transition: 0.3s;
            border-radius: 26px;
        }

        .slider-switch:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: #fff;
            transition: 0.3s;
            border-radius: 50%;
        }

        .switch input:checked+.slider-switch {
            background-color: var(--switch-on);
        }

        .switch input:checked+.slider-switch:before {
            transform: translateX(22px);
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 20px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        footer a {
            color: var(--brand-primary);
            text-decoration: none;
            font-weight: 600;
        }

        footer a:hover {
            text-decoration: underline;
        }

        /* Responsive */
        @media (max-width: 900px) {
            #mainWrapper {
                flex-direction: column;
            }

            #sideControls {
                width: 100%;
                min-width: unset;
            }

            #waveCanvas {
                height: 300px;
            }

            header.banner {
                flex-direction: column;
                text-align: center;
            }

            .banner-actions {
                width: 100%;
                justify-content: center;
            }

            .banner-title {
                font-size: 1.2rem;
            }
        }

        @media (max-width: 480px) {
            header.banner {
                padding: 8px 12px;
            }

            .banner-logo img {
                height: 28px;
            }

            .banner-title {
                font-size: 1rem;
            }

            .main-content {
                padding: 12px;
            }
        }

        @media (pointer: coarse) {
            button,
            input:not([type="range"]),
            select,
            .theme-toggle {
                min-height: 44px;
                touch-action: manipulation;
            }

            input[type="range"] {
                padding: 19px 0;
                touch-action: manipulation;
            }

            input[type="range"]::-webkit-slider-runnable-track {
                height: 6px;
            }

            input[type="range"]::-webkit-slider-thumb {
                width: 28px;
                height: 28px;
                margin-top: -11px;
            }

            input[type="range"]::-moz-range-thumb {
                width: 28px;
                height: 28px;
            }

            canvas {
                touch-action: none;
            }
        }
    </style>
</head>

<body>
    <header class="banner">
        <div class="banner-logo">
            <a href="https://panphy.github.io/">
                <img src="/panphy.png" alt="PanPhy logo">
            </a>
        </div>
        <div class="banner-title">Wave Superposition</div>
        <div class="banner-actions">
            <div class="theme-toggle">
                <button id="theme-button" aria-label="Toggle Light/Dark Theme" title="Toggle between light and dark themes">&#9728;&#65039;</button>
            </div>
        </div>
    </header>

    <div class="main-content">
        <p class="instructions">Press SPACE to Pause/Resume the Simulation</p>

        <div id="mainWrapper">
            <div id="canvasContainer">
                <div id="zoomMotionControls">
                    <div class="zoomMotion-group">
                        <label for="timeZoom">
                            Horizontal Scale: <span id="timeZoomValue">1.0</span>x
                        </label>
                        <input type="range" id="timeZoom" min="0.1" max="5" step="0.1" value="1">
                    </div>
                    <div class="zoomMotion-group">
                        <label for="timeMotion">
                            Motion Speed: <span id="timeMotionValue">1.00</span>x
                        </label>
                        <input type="range" id="timeMotion" min="0.01" max="2" step="0.01" value="1">
                    </div>
                </div>
                <canvas id="waveCanvas"></canvas>
                <button id="playPauseBtn">Pause</button>
                <div id="note">
                    Press SPACE to Pause/Resume
                </div>
            </div>

            <div id="sideControls">
                <div class="wave-controls">
                    <h3>Wave 1 (Left to Right)</h3>
                    <div class="control-group">
                        <label for="amplitude1">
                            Amplitude: <span id="amplitude1Value">60</span> px
                        </label>
                        <input type="range" id="amplitude1" min="10" max="100" value="60">
                    </div>
                    <div class="control-group">
                        <label for="frequency1">
                            Frequency: <span id="frequency1Value">1.0</span> Hz
                        </label>
                        <input type="range" id="frequency1" min="0.1" max="5" step="0.1" value="1">
                    </div>
                    <div class="control-group">
                        <label for="speed1">
                            Wave Speed: <span id="speed1Value">200</span> px/s
                        </label>
                        <input type="range" id="speed1" min="50" max="500" step="10" value="200">
                    </div>
                </div>

                <div class="wave-controls">
                    <h3>Wave 2 (Right to Left)</h3>
                    <div class="control-group">
                        <label for="amplitude2">
                            Amplitude: <span id="amplitude2Value">60</span> px
                        </label>
                        <input type="range" id="amplitude2" min="10" max="100" value="60">
                    </div>
                    <div class="control-group">
                        <label for="frequency2">
                            Frequency: <span id="frequency2Value">1.0</span> Hz
                        </label>
                        <input type="range" id="frequency2" min="0.1" max="5" step="0.1" value="1.0">
                    </div>
                    <div class="control-group">
                        <label for="speed2">
                            Wave Speed: <span id="speed2Value">200</span> px/s
                        </label>
                        <input type="range" id="speed2" min="50" max="500" step="10" value="200">
                    </div>
                </div>

                <div class="toggle-controls">
                    <h3>Toggle Waves</h3>
                    <div class="toggle-group">
                        <label for="toggleWave1">Show Wave 1 (Blue)</label>
                        <label class="switch">
                            <input type="checkbox" id="toggleWave1" checked>
                            <span class="slider-switch"></span>
                        </label>
                    </div>
                    <div class="toggle-group">
                        <label for="toggleWave2">Show Wave 2 (Orange)</label>
                        <label class="switch">
                            <input type="checkbox" id="toggleWave2">
                            <span class="slider-switch"></span>
                        </label>
                    </div>
                    <div class="toggle-group">
                        <label for="toggleSuperposition">Show Superposition (Green)</label>
                        <label class="switch">
                            <input type="checkbox" id="toggleSuperposition">
                            <span class="slider-switch"></span>
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        &copy; <a href="/">PanPhy Projects</a> |
        <a href="https://buymeacoffee.com/panphy" target="_blank" rel="noopener noreferrer">Support My Projects</a>
    </footer>

    <script>
        // Theme Toggle
        const themeButton = document.getElementById('theme-button');
        const DARK_THEME_KEY = "panphy-dark";
        const LIGHT_THEME_KEY = "panphy-light";

        const currentTheme = localStorage.getItem(DARK_THEME_KEY) ?
            "dark" :
            localStorage.getItem(LIGHT_THEME_KEY) ?
                "light" :
                "light";

        document.documentElement.setAttribute('data-theme', currentTheme);
        updateButtonEmoji(currentTheme);

        function updateButtonEmoji(theme) {
            themeButton.textContent = theme === 'dark' ? '\u{1F319}' : '\u{2600}\u{FE0F}';
        }

        themeButton.addEventListener('click', function () {
            let theme = document.documentElement.getAttribute('data-theme');
            if (theme === 'light') {
                document.documentElement.setAttribute('data-theme', 'dark');
                localStorage.setItem(DARK_THEME_KEY, 'true');
                localStorage.removeItem(LIGHT_THEME_KEY);
                updateButtonEmoji('dark');
            } else {
                document.documentElement.setAttribute('data-theme', 'light');
                localStorage.setItem(LIGHT_THEME_KEY, 'true');
                localStorage.removeItem(DARK_THEME_KEY);
                updateButtonEmoji('light');
            }
        });

        // Offline font fallback
        function updateOfflineFontState() {
            document.documentElement.classList.toggle('offline-font', !navigator.onLine);
        }
        window.addEventListener('online', updateOfflineFontState);
        window.addEventListener('offline', updateOfflineFontState);
        updateOfflineFontState();

        // Canvas & Controls
        const canvas = document.getElementById('waveCanvas');
        const ctx = canvas.getContext('2d');
        const playPauseBtn = document.getElementById('playPauseBtn');

        const amplitude1Slider = document.getElementById('amplitude1');
        const frequency1Slider = document.getElementById('frequency1');
        const speed1Slider = document.getElementById('speed1');
        const amplitude1Value = document.getElementById('amplitude1Value');
        const frequency1Value = document.getElementById('frequency1Value');
        const speed1Value = document.getElementById('speed1Value');

        const amplitude2Slider = document.getElementById('amplitude2');
        const frequency2Slider = document.getElementById('frequency2');
        const speed2Slider = document.getElementById('speed2');
        const amplitude2Value = document.getElementById('amplitude2Value');
        const frequency2Value = document.getElementById('frequency2Value');
        const speed2Value = document.getElementById('speed2Value');

        const timeZoomSlider = document.getElementById('timeZoom');
        const timeZoomValue = document.getElementById('timeZoomValue');
        const timeMotionSlider = document.getElementById('timeMotion');
        const timeMotionValue = document.getElementById('timeMotionValue');

        const toggleWave1 = document.getElementById('toggleWave1');
        const toggleWave2 = document.getElementById('toggleWave2');
        const toggleSuperposition = document.getElementById('toggleSuperposition');

        let width, height;

        let amplitude1 = parseFloat(amplitude1Slider.value);
        let frequency1 = parseFloat(frequency1Slider.value);
        let speed1 = parseFloat(speed1Slider.value);

        let amplitude2 = parseFloat(amplitude2Slider.value);
        let frequency2 = parseFloat(frequency2Slider.value);
        let speed2 = parseFloat(speed2Slider.value);

        let timeZoom = parseFloat(timeZoomSlider.value);
        let timeMotion = parseFloat(timeMotionSlider.value);

        function updateSliderValues() {
            amplitude1Value.textContent = amplitude1.toFixed(0);
            frequency1Value.textContent = frequency1.toFixed(1);
            speed1Value.textContent = speed1.toFixed(0);

            amplitude2Value.textContent = amplitude2.toFixed(0);
            frequency2Value.textContent = frequency2.toFixed(1);
            speed2Value.textContent = speed2.toFixed(0);

            timeZoomValue.textContent = timeZoom.toFixed(1);
            timeMotionValue.textContent = timeMotion.toFixed(2);
        }
        updateSliderValues();

        amplitude1Slider.addEventListener('input', () => {
            amplitude1 = parseFloat(amplitude1Slider.value);
            updateSliderValues();
            drawWaves();
        });
        frequency1Slider.addEventListener('input', () => {
            frequency1 = parseFloat(frequency1Slider.value);
            updateSliderValues();
            drawWaves();
        });
        speed1Slider.addEventListener('input', () => {
            speed1 = parseFloat(speed1Slider.value);
            updateSliderValues();
            drawWaves();
        });

        amplitude2Slider.addEventListener('input', () => {
            amplitude2 = parseFloat(amplitude2Slider.value);
            updateSliderValues();
            drawWaves();
        });
        frequency2Slider.addEventListener('input', () => {
            frequency2 = parseFloat(frequency2Slider.value);
            updateSliderValues();
            drawWaves();
        });
        speed2Slider.addEventListener('input', () => {
            speed2 = parseFloat(speed2Slider.value);
            updateSliderValues();
            drawWaves();
        });

        timeZoomSlider.addEventListener('input', () => {
            timeZoom = parseFloat(timeZoomSlider.value);
            updateSliderValues();
            drawWaves();
        });
        timeMotionSlider.addEventListener('input', () => {
            timeMotion = parseFloat(timeMotionSlider.value);
            updateSliderValues();
            drawWaves();
        });

        toggleWave1.addEventListener('change', () => { drawWaves(); });
        toggleWave2.addEventListener('change', () => { drawWaves(); });
        toggleSuperposition.addEventListener('change', () => { drawWaves(); });

        playPauseBtn.addEventListener('click', () => {
            running = !running;
            if (running) {
                playPauseBtn.textContent = "Pause";
                lastTimestamp = null;
                animationId = requestAnimationFrame(animate);
            } else {
                playPauseBtn.textContent = "Play";
                cancelAnimationFrame(animationId);
            }
        });

        function setupCanvas() {
            ctx.setTransform(1, 0, 0, 1, 0, 0);
            const ratio = window.devicePixelRatio || 1;
            const computedStyle = getComputedStyle(canvas);
            width = parseInt(computedStyle.getPropertyValue('width'));
            height = parseInt(computedStyle.getPropertyValue('height'));

            canvas.width = width * ratio;
            canvas.height = height * ratio;
            ctx.scale(ratio, ratio);
        }

        setupCanvas();
        window.addEventListener('resize', () => {
            setupCanvas();
            drawWaves();
        });

        let animationId;
        let running = true;
        let lastTimestamp = null;
        let accumulatedTime = 0;

        function getBaselineColor() {
            return getComputedStyle(document.documentElement).getPropertyValue('--canvas-baseline').trim() || '#cbd5e1';
        }

        function drawWaves() {
            const t = accumulatedTime / 1000;

            ctx.clearRect(0, 0, width, height);

            const baseline = height / 2;
            ctx.beginPath();
            ctx.moveTo(0, baseline);
            ctx.lineTo(width, baseline);
            ctx.strokeStyle = getBaselineColor();
            ctx.lineWidth = 2;
            ctx.stroke();

            const omega1 = 2 * Math.PI * frequency1;
            const omega2 = 2 * Math.PI * frequency2;

            const actualSpeed1 = Math.max(speed1, 1e-6);
            const actualSpeed2 = Math.max(speed2, 1e-6);

            const k1 = omega1 / actualSpeed1;
            const k2 = omega2 / actualSpeed2;

            if (toggleWave1.checked) {
                ctx.beginPath();
                for (let x = 0; x <= width; x++) {
                    const xVirtual = x / timeZoom;
                    const wave1Val = amplitude1 * Math.sin(k1 * xVirtual - omega1 * t);
                    const canvasY = baseline - wave1Val;
                    if (x === 0) ctx.moveTo(x, canvasY);
                    else ctx.lineTo(x, canvasY);
                }
                ctx.strokeStyle = '#3b82f6';
                ctx.lineWidth = 2;
                ctx.stroke();
            }

            if (toggleWave2.checked) {
                ctx.beginPath();
                for (let x = 0; x <= width; x++) {
                    const xVirtual = x / timeZoom;
                    const wave2Val = amplitude2 * Math.sin(k2 * xVirtual + omega2 * t);
                    const canvasY = baseline - wave2Val;
                    if (x === 0) ctx.moveTo(x, canvasY);
                    else ctx.lineTo(x, canvasY);
                }
                ctx.strokeStyle = '#f97316';
                ctx.lineWidth = 2;
                ctx.stroke();
            }

            if (toggleSuperposition.checked) {
                ctx.beginPath();
                for (let x = 0; x <= width; x++) {
                    const xVirtual = x / timeZoom;
                    const wave1Val = amplitude1 * Math.sin(k1 * xVirtual - omega1 * t);
                    const wave2Val = amplitude2 * Math.sin(k2 * xVirtual + omega2 * t);
                    const sumVal = wave1Val + wave2Val;
                    const canvasY = baseline - sumVal;
                    if (x === 0) ctx.moveTo(x, canvasY);
                    else ctx.lineTo(x, canvasY);
                }
                ctx.strokeStyle = '#22c55e';
                ctx.lineWidth = 2.5;
                ctx.stroke();
            }
        }

        function animate(timestamp) {
            if (!running) {
                lastTimestamp = null;
                return;
            }
            if (!lastTimestamp) lastTimestamp = timestamp;

            const delta = timestamp - lastTimestamp;
            lastTimestamp = timestamp;
            accumulatedTime += delta * timeMotion;
            drawWaves();
            animationId = requestAnimationFrame(animate);
        }

        animationId = requestAnimationFrame(animate);

        window.addEventListener('keydown', (e) => {
            const target = e.target;
            if (target instanceof HTMLElement) {
                const tagName = target.tagName;
                if (target.isContentEditable || tagName === 'INPUT' || tagName === 'BUTTON' || tagName === 'LABEL') {
                    return;
                }
            }
            if (e.code === 'Space' || e.key === ' ') {
                e.preventDefault();
                running = !running;
                if (running) {
                    playPauseBtn.textContent = "Pause";
                    lastTimestamp = null;
                    animationId = requestAnimationFrame(animate);
                } else {
                    playPauseBtn.textContent = "Play";
                    cancelAnimationFrame(animationId);
                }
            }
        });
    </script>
</body>

</html>
