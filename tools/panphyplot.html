<!DOCTYPE html>
<html lang="en" data-theme="light">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<title>PanPhyPlot</title>
	<link rel="icon" type="image/png" href="/favicon.png">
	<script>
		if ('serviceWorker' in navigator) {
			window.addEventListener('load', () => {
				navigator.serviceWorker.register('/sw.js')
					.then((reg) => console.log('Service Worker registered!', reg))
					.catch((err) => console.log('Service Worker registration failed', err));
			});
		}
	</script>
	<!-- Plotly.js for graphing -->
	<script src="https://cdn.plot.ly/plotly-2.29.1.min.js"></script>
	<!-- Math.js for computations -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.5.0/math.min.js"></script>
	<!-- MathJax v2 for LaTeX rendering -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_SVG.js"></script>

	<link rel="stylesheet" href="/tools/panphyplot/css/panphyplot.css">
</head>

<body>
	<div class="banner">
		<!-- Logo on the Left -->
		<div class="banner-logo">
			<a href="https://panphy.github.io/" target="_blank" rel="noopener noreferrer">
				<img src="/panphy.png" alt="PanPhy logo" />
			</a>
		</div>

		<!-- Title in the Center -->
		<div class="banner-title">PanPhyPlot</div>

		<!-- Buttons on the Right -->
		<div class="banner-buttons">
			<a href="/tools/panphyplot/panphyplot_manual.html" class="banner-button" target="_blank" rel="noopener noreferrer">Manual</a>
			<div class="theme-toggle">
				<button id="theme-button" aria-label="Toggle Light/Dark Theme">☀️</button>
			</div>
		</div>
	</div>

	<div class="reminder">
		<span>Note: Headings and Title accept LaTeX input when LaTeX mode is ON.</span>
		<div class="latex-toggle-container">
			<!-- Toggle switch -->
			<label class="switch">
				<input type="checkbox" id="latex-mode-toggle">
				<span class="slider"></span>
			</label>
			<span class="toggle-label">LaTeX mode</span>
		</div>
	</div>

	<!-- Dataset Tabs Bar with "Add Dataset" button -->
	<div class="dataset-tabs-bar">
		<!-- Example initial tab -->
		<div class="dataset-tab active">
			<span class="tab-label">Dataset 1</span>
			<span class="tab-close" title="Remove dataset">×</span>
		</div>
		<!-- The Add Dataset button looks just like a tab except it keeps its own color -->
		<button class="add-dataset-btn">Add Dataset</button>
	</div>

	<!-- Main container: left = Input section, right = Graph section -->
	<div class="container">
		<!-- Input section -->
		<div class="input-section">
			<h2>Data</h2>
			<div class="table-container">
				<table class="data-table" id="data-table">
					<thead>
						<tr>
							<th>
								<input type="text" id="x-column-name" value="x" oninput="updateLabels('x')" />
								<div id="x-column-latex" class="latex-display">\( x \)</div>
							</th>
							<th>
								<input type="text" id="y-column-name" value="y" oninput="updateLabels('y')" />
								<div id="y-column-latex" class="latex-display">\( y \)</div>
							</th>
							<th class="error-column" id="x-error-header" style="display: none;">
								<div id="x-error-header-latex" class="latex-display">\( \pm \Delta x \)</div>
							</th>
							<th class="error-column" id="y-error-header" style="display: none;">
								<div id="y-error-header-latex" class="latex-display">\( \pm \Delta y \)</div>
							</th>
						</tr>
					</thead>
					<tbody>
						<!-- Rows inserted by JS -->
					</tbody>
				</table>
			</div>

			<div class="button-container">
				<div class="button-row">
					<button class="btn-add-row" onclick="addRow()">Add Row</button>
					<button class="btn-copy-x" onclick="copyXFromSet1()">Copy x₁</button>
					<button class="btn-clear-all" onclick="clearRows()">Clear Data</button>
				</div>
				<div class="button-row">
					<button class="btn-import-csv" onclick="document.getElementById('csv-file-input').click()">
						Import .csv
					</button>
					<button class="btn-export-csv" onclick="exportCSV()">Export .csv</button>
					<button class="btn-export-md" onclick="exportPlainText()">Export .md</button>
				</div>
			</div>
			<input type="file" id="csv-file-input" accept=".csv" style="display: none;" onchange="handleCSVUpload(event)" />

			<div class="global-uncertainty">
				<button
					class="section-toggle"
					type="button"
					aria-expanded="false"
					aria-controls="uncertainties-content"
					onclick="toggleSection('uncertainties-content', this)"
				>
					Add Uncertainties
				</button>
				<div id="uncertainties-content" class="collapsible-content">
					<div class="uncertainty-controls">
						<div>
							<label>
								<input type="checkbox" id="toggle-x-error" onclick="toggleErrorColumn('x')" />
								Δx
							</label>
							<select id="x-error-type" onchange="updateErrorType('x')">
								<option value="absolute">absolute</option>
								<option value="percentage">%</option>
							</select>
						</div>
						<div>
							<label>
								<input type="checkbox" id="toggle-y-error" onclick="toggleErrorColumn('y')" />
								Δy
							</label>
							<select id="y-error-type" onchange="updateErrorType('y')">
								<option value="absolute">absolute</option>
								<option value="percentage">%</option>
							</select>
						</div>
					</div>

					<h3>Apply Global Uncertainty</h3>
					<div class="global-uncertainty-item">
						<input type="text" id="global-x-uncertainty" placeholder="Enter Δx" />
						<button onclick="applyGlobalUncertainties('x')">Apply Δx</button>
					</div>
					<div class="global-uncertainty-item">
						<input type="text" id="global-y-uncertainty" placeholder="Enter Δy" />
						<button onclick="applyGlobalUncertainties('y')">Apply Δy</button>
					</div>
				</div>
			</div>

			<div class="fit-method-section">
				<button
					class="section-toggle"
					type="button"
					aria-expanded="false"
					aria-controls="best-fit-content"
					onclick="toggleSection('best-fit-content', this)"
				>
					Add Best Fit Line
				</button>
				<div id="best-fit-content" class="collapsible-content">
					<div class="tabs">
						<button class="tablink active" onclick="openTab(event, 'BasicFit')">Basic Fit</button>
						<button class="tablink" onclick="openTab(event, 'AdvancedFit')">Advanced Fit</button>
					</div>

					<!-- Basic Fit -->
					<div id="BasicFit" class="tab-content active">
						<label for="fit-method">Fit Method:</label>
						<select id="fit-method" onchange="updateBasicFitEquation()">
							<option value="Linear">Linear</option>
							<option value="Polynomial-2">Quadratic</option>
							<option value="Polynomial-3">Cubic</option>
							<!-- <option value="Polynomial-4">Polynomial (4th Degree)</option> -->
							<!-- Disabled 4th Degree Polynomial due to lack of applications -->
							<option value="Exponential">Exponential</option>
							<option value="Power">Power</option>
						</select>
						<div id="basic-fit-equation" class="general-equation">
							\( y = mx + c \)
						</div>
						<div style="display: flex; gap: 6px;">
							<button class="fit-button" onclick="fitCurve()">Fit Curve</button>
							<button class="clear-fit-button" onclick="clearFittedCurve()">Clear Fit</button>
						</div>
					</div>

					<!-- Advanced Fit -->
					<div id="AdvancedFit" class="tab-content">
						<label for="advanced-fit-method">Advanced Fit Method:</label>
						<select id="advanced-fit-method" class="fit-method-select" onchange="changeAdvancedFitMethod()">
							<option value="Sinusoidal">Sinusoidal</option>
							<option value="Gaussian">Gaussian</option>
						</select>
						<div id="advanced-fit-general-equation" class="general-equation">
							\( y = A e^{bx} \sin(kx - \phi) + c \)
						</div>
						<p class="table-prompt">Enter initial fitting parameters below.</p>

						<!-- Sinusoidal -->
						<div id="Sinusoidal-parameters" class="parameter-section active">
							<div class="advanced-fit-item">
								<label for="initial-A">A:</label>
								<input type="number" id="initial-A" value="1" step="any" />
							</div>
							<div class="advanced-fit-item">
								<label for="initial-b">b:</label>
								<input type="number" id="initial-b" value="0" step="any" />
							</div>
							<div class="advanced-fit-item">
								<label for="initial-k">k:</label>
								<input type="number" id="initial-k" value="1" step="any" />
							</div>
							<div class="advanced-fit-item">
								<label for="initial-phi">φ:</label>
								<input type="number" id="initial-phi" value="0" step="any" />
							</div>
							<div class="advanced-fit-item">
								<label for="initial-c">c:</label>
								<input type="number" id="initial-c" value="0" step="any" />
							</div>
						</div>

						<!-- Gaussian -->
						<div id="Gaussian-parameters" class="parameter-section">
							<div class="advanced-fit-item">
								<label for="initial-A-gaussian">A:</label>
								<input type="number" id="initial-A-gaussian" value="1" step="any" />
							</div>
							<div class="advanced-fit-item">
								<label for="initial-mu">μ:</label>
								<input type="number" id="initial-mu" value="0" step="any" />
							</div>
							<div class="advanced-fit-item">
								<label for="initial-sigma">σ:</label>
								<input type="number" id="initial-sigma" value="1" step="any" />
							</div>
							<div class="advanced-fit-item">
								<label for="initial-c-gaussian">c:</label>
								<input type="number" id="initial-c-gaussian" value="0" step="any" />
							</div>
						</div>

						<div style="display: flex; gap: 6px;">
							<button class="fit-button" onclick="fitAdvancedCurve()">Fit Curve</button>
							<button class="clear-fit-button" onclick="clearFittedCurve()">Clear Fit</button>
						</div>
					</div>
				</div>
			</div>
		</div><!-- end input-section -->

		<!-- Graph section -->
		<div class="graph-section">
			<h2>Graph</h2>
			<div class="graph-title-container">
				<label for="graph-title">Title:</label>
				<input type="text" id="graph-title" placeholder="Enter graph title" oninput="debouncedUpdatePlotAndRenderLatex()">
			</div>
			<div id="plot"></div>

			<div class="result">
				<h3>Fitting Result</h3>
				<p id="fit-equation" style="display: none;"></p>
				<p id="r-squared-container" style="display: none;"></p>
			</div>

			<div class="plot-all-container">
				<button class="plot-all-btn" onclick="plotAllDatasets()">Plot ALL Datasets</button>
			</div>
		</div><!-- end graph-section -->
	</div><!-- end container -->

	<!-- Transparent background for the popup -->
	<div id="popup-background" style="display: none;"></div>

	<div id="popup-container" style="display: none;">
		<div id="popup-content">
			<button id="popup-close" onclick="closePopup()">Close</button>
			<div id="popup-title">Combined Plot of All Datasets</div>
			<div id="popup-plot-container">
				<div id="popup-plot"></div>
			</div>
			<div id="combined-plot-controls" class="combined-plot-controls">
				<div class="control-row-horizontal">
					<label for="combined-title">Title:</label>
					<input type="text" id="combined-title" placeholder="Enter a new Title here" />
				</div>
				<div class="control-row-horizontal">
					<label for="combined-x-label">x-axis Label:</label>
					<input type="text" id="combined-x-label" placeholder="Enter a new x-axis label here" />
				</div>
				<div class="control-row-horizontal">
					<label for="combined-y-label">y-axis Label:</label>
					<input type="text" id="combined-y-label" placeholder="Enter a new y-axis label here" />
				</div>
			</div>
		</div>
	</div>

	<footer>
		&copy; <a href="https://panphy.github.io/" target="_blank" rel="noopener noreferrer">PanPhy</a> |
		<a href="https://buymeacoffee.com/panphy" target="_blank" rel="noopener noreferrer">Support My Projects</a>
	</footer>

	<!--
		PanPhyPlot file structure:
		- /tools/panphyplot/css/panphyplot.css (styles)
		- /tools/panphyplot/js/state.js (shared state)
		- /tools/panphyplot/js/latex-rendering.js (LaTeX helpers)
		- /tools/panphyplot/js/plotting.js (Plotly rendering)
		- /tools/panphyplot/js/curve-fitting.js (fit logic)
		- /tools/panphyplot/js/ui.js (UI + table/data handling)
		- /tools/panphyplot/js/main.js (bootstrap)
	-->
	<script src="/tools/panphyplot/js/state.js"></script>
	<script src="/tools/panphyplot/js/latex-rendering.js"></script>
	<script src="/tools/panphyplot/js/plotting.js"></script>
	<script src="/tools/panphyplot/js/curve-fitting.js"></script>
	<script src="/tools/panphyplot/js/ui.js"></script>
	<script src="/tools/panphyplot/js/main.js"></script>
</body>



</html>
