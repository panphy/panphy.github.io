<!DOCTYPE html>
<html lang="en" data-theme="light">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<title>PanPhyPlot</title>
	<link rel="icon" type="image/png" href="/assets/favicon.png">
    <script src="/assets/sw-register.js" defer></script>
<!-- Plotly.js for graphing -->
	<script src="https://cdn.plot.ly/plotly-2.29.1.min.js"></script>
	<!-- Math.js for computations -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.5.0/math.min.js"></script>
	<!-- MathJax v2 Configuration (must be before MathJax script) -->
	<script type="text/x-mathjax-config">
		MathJax.Hub.Config({
			tex2jax: {
				inlineMath: [['$','$'], ['\\(','\\)']],
				displayMath: [['$$','$$'], ['\\[','\\]']],
				processEscapes: true
			}
		});
	</script>
	<!-- MathJax v2 for LaTeX rendering -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_SVG.js"></script>
	<!-- Marked.js for Markdown parsing (used in View Table) -->
	<script src="https://cdn.jsdelivr.net/npm/marked@4.3.0/marked.min.js"></script>
	<!-- DOMPurify for sanitizing HTML (used in View Table) -->
	<script src="https://cdn.jsdelivr.net/npm/dompurify@2.3.4/dist/purify.min.js"></script>

	<link rel="stylesheet" href="/tools/panphyplot/css/panphyplot.css">
</head>

<body>
	<div class="banner">
		<!-- Logo on the Left -->
		<div class="banner-logo">
			<a href="https://panphy.github.io/">
				<img src="/assets/panphy.png" alt="PanPhy logo" />
			</a>
		</div>

		<!-- Title in the Center -->
		<div class="banner-title">PanPhyPlot</div>

		<!-- Buttons on the Right -->
		<div class="banner-buttons">
			<a href="/tools/panphyplot/panphyplot_manual.html" class="banner-button"
				title="Open the PanPhyPlot manual">Manual</a>
			<div class="theme-toggle">
				<button id="theme-button" aria-label="Toggle Light/Dark Theme"
					title="Toggle between light and dark themes">☀️</button>
			</div>
		</div>
	</div>

	<div class="reminder">
		<span>Note: Headings and Title accept LaTeX input when LaTeX mode is ON.</span>
		<div class="latex-toggle-container">
			<!-- Toggle switch -->
			<label class="switch">
				<input type="checkbox" id="latex-mode-toggle">
				<span class="slider"></span>
			</label>
			<span class="toggle-label">LaTeX mode</span>
		</div>
	</div>

	<!-- Dataset Tabs Bar with "Add Dataset" button -->
	<div class="dataset-tabs-bar">
		<!-- Example initial tab -->
						<div class="dataset-tab active">
							<span class="tab-label">Dataset 1</span>
							<button class="tab-close" type="button" title="Remove dataset" aria-label="Remove dataset">×</button>
						</div>
		<!-- The Add Dataset button looks just like a tab except it keeps its own color -->
		<button class="add-dataset-btn" type="button" title="Add a new dataset" aria-label="Add dataset">+</button>
	</div>

	<!-- Main container: left = Input section, right = Graph section -->
	<div class="container">
		<!-- Input section -->
		<div class="input-section">
			<h2>Data</h2>
			<div class="table-container">
				<table class="data-table" id="data-table">
					<thead>
						<tr>
							<th>
								<input type="text" id="x-column-name" value="x" oninput="updateLabels('x')" aria-label="X column name" />
								<div id="x-column-latex" class="latex-display">\( x \)</div>
							</th>
							<th>
								<input type="text" id="y-column-name" value="y" oninput="updateLabels('y')" aria-label="Y column name" />
								<div id="y-column-latex" class="latex-display">\( y \)</div>
							</th>
							<th class="error-column" id="x-error-header" style="display: none;">
								<div id="x-error-header-latex" class="latex-display">\( \pm \Delta x \)</div>
							</th>
							<th class="error-column" id="y-error-header" style="display: none;">
								<div id="y-error-header-latex" class="latex-display">\( \pm \Delta y \)</div>
							</th>
						</tr>
					</thead>
					<tbody>
						<!-- Rows inserted by JS -->
					</tbody>
				</table>
			</div>

			<div class="button-container">
				<div class="button-row">
					<button class="btn-add-row" onclick="addRow()" title="Add a new data row to this dataset">Add
						Row</button>
					<button class="btn-copy-x" onclick="copyXFromSet1()"
						title="Copy x-values from Dataset 1 into this dataset">Copy x₁</button>
					<button class="btn-clear-all" onclick="confirmClearRows()"
						title="Clear all data rows in this dataset">Clear Data</button>
				</div>
				<div class="button-row">
					<button class="btn-import-csv" onclick="confirmImportCSV()"
						title="Import data from a CSV file">
						Import .csv
					</button>
					<button class="btn-export-csv" onclick="showFilenamePrompt('csv')"
						title="Export this dataset to a CSV file">Export .csv</button>
					<button class="btn-export-md" onclick="showExportTablePopup()"
						title="View this dataset as a formatted table">View Table</button>
				</div>
				<div class="button-row">
					<button class="btn-data-processing" onclick="openDataProcessingPopup()"
						title="Create processed columns from the current dataset">Data Processing</button>
				</div>
			</div>
			<input type="file" id="csv-file-input" accept=".csv" style="display: none;"
				onchange="handleCSVUpload(event)" />

			<div class="global-uncertainty">
				<button class="section-toggle" type="button" aria-expanded="false" aria-controls="uncertainties-content"
					onclick="toggleSection('uncertainties-content', this)" title="Show or hide uncertainty controls">
					Add Uncertainties
				</button>
				<div id="uncertainties-content" class="collapsible-content">
					<div class="uncertainty-card">
						<div class="uncertainty-card-toggle">
							<div class="uncertainty-toggle-group">
								<label class="switch">
									<input type="checkbox" id="toggle-x-error" onclick="toggleErrorColumn('x')" />
									<span class="slider"></span>
								</label>
								<span class="uncertainty-label">Δx</span>
							</div>
							<select id="x-error-type" onchange="updateErrorType('x')" class="uncertainty-type-select">
								<option value="absolute">Absolute</option>
								<option value="percentage">Percentage (%)</option>
							</select>
						</div>
						<div class="uncertainty-card-body">
							<input type="text" id="global-x-uncertainty" placeholder="Value for all rows" />
							<button onclick="applyGlobalUncertainties('x')"
								title="Apply this Δx to all rows in the current dataset">Apply to All</button>
						</div>
					</div>
					<div class="uncertainty-card">
						<div class="uncertainty-card-toggle">
							<div class="uncertainty-toggle-group">
								<label class="switch">
									<input type="checkbox" id="toggle-y-error" onclick="toggleErrorColumn('y')" />
									<span class="slider"></span>
								</label>
								<span class="uncertainty-label">Δy</span>
							</div>
							<select id="y-error-type" onchange="updateErrorType('y')" class="uncertainty-type-select">
								<option value="absolute">Absolute</option>
								<option value="percentage">Percentage (%)</option>
							</select>
						</div>
						<div class="uncertainty-card-body">
							<input type="text" id="global-y-uncertainty" placeholder="Value for all rows" />
							<button onclick="applyGlobalUncertainties('y')"
								title="Apply this Δy to all rows in the current dataset">Apply to All</button>
						</div>
					</div>
				</div>
			</div>

			<div class="fit-method-section">
				<button class="section-toggle" type="button" aria-expanded="false" aria-controls="best-fit-content"
					onclick="toggleSection('best-fit-content', this)" title="Show or hide best-fit line options">
					Add Best Fit Line
				</button>
				<div id="best-fit-content" class="collapsible-content">
					<div class="tabs">
						<button class="tablink active" onclick="openTab(event, 'BasicFit')"
							title="Show basic best-fit options">Basic Fit</button>
						<button class="tablink" onclick="openTab(event, 'AdvancedFit')"
							title="Show advanced best-fit options">Advanced Fit</button>
					</div>

					<!-- Basic Fit -->
					<div id="BasicFit" class="tab-content active">
						<label for="fit-method">Fit Method:</label>
						<select id="fit-method" onchange="updateBasicFitEquation()">
							<option value="Linear">Linear</option>
							<option value="Polynomial-2">Quadratic</option>
							<option value="Polynomial-3">Cubic</option>
							<!-- <option value="Polynomial-4">Polynomial (4th Degree)</option> -->
							<!-- Disabled 4th Degree Polynomial due to lack of applications -->
							<option value="Exponential">Exponential</option>
							<option value="Power">Power</option>
						</select>
						<div id="basic-fit-equation" class="general-equation">
							\( y = mx + c \)
						</div>
						<div style="display: flex; gap: 6px;">
							<button class="fit-button" onclick="fitCurve()"
								title="Fit a curve to the selected dataset">Fit Curve</button>
							<button class="clear-fit-button" onclick="clearFittedCurve()"
								title="Remove the current fitted curve">Clear Fit</button>
						</div>
					</div>

					<!-- Advanced Fit -->
					<div id="AdvancedFit" class="tab-content">
						<label for="advanced-fit-method">Advanced Fit Method:</label>
						<select id="advanced-fit-method" class="fit-method-select" onchange="changeAdvancedFitMethod()">
							<option value="Sinusoidal">Sinusoidal</option>
							<option value="Gaussian">Gaussian</option>
						</select>
						<div id="advanced-fit-general-equation" class="general-equation">
							\( y = A e^{bx} \sin(kx - \phi) + c \)
						</div>
						<p class="table-prompt">Adjust the initial fitting parameters below.</p>

						<!-- Sinusoidal -->
						<div id="Sinusoidal-parameters" class="parameter-section active">
							<div class="advanced-fit-top-row">
								<div class="advanced-fit-item">
									<label for="initial-A">A:</label>
									<input type="number" id="initial-A" value="1" step="any" />
								</div>
								<button type="button" class="advanced-fit-reset-btn"
									onclick="resetAdvancedFitParameters('Sinusoidal')"
									title="Reset sinusoidal initial parameters">Reset parameters</button>
							</div>
							<div class="advanced-fit-item">
								<label for="initial-b">b:</label>
								<input type="number" id="initial-b" value="0" step="any" />
							</div>
							<div class="advanced-fit-item">
								<label for="initial-k">k:</label>
								<input type="number" id="initial-k" value="1" step="any" />
							</div>
							<div class="advanced-fit-item">
								<label for="initial-phi">φ:</label>
								<input type="number" id="initial-phi" value="0" step="any" />
							</div>
							<div class="advanced-fit-item">
								<label for="initial-c">c:</label>
								<input type="number" id="initial-c" value="0" step="any" />
							</div>
						</div>

						<!-- Gaussian -->
						<div id="Gaussian-parameters" class="parameter-section">
							<div class="advanced-fit-top-row">
								<div class="advanced-fit-item">
									<label for="initial-A-gaussian">A:</label>
									<input type="number" id="initial-A-gaussian" value="1" step="any" />
								</div>
								<button type="button" class="advanced-fit-reset-btn"
									onclick="resetAdvancedFitParameters('Gaussian')"
									title="Reset gaussian initial parameters">Reset parameters</button>
							</div>
							<div class="advanced-fit-item">
								<label for="initial-mu">μ:</label>
								<input type="number" id="initial-mu" value="0" step="any" />
							</div>
							<div class="advanced-fit-item">
								<label for="initial-sigma">σ:</label>
								<input type="number" id="initial-sigma" value="1" step="any" />
							</div>
							<div class="advanced-fit-item">
								<label for="initial-c-gaussian">c:</label>
								<input type="number" id="initial-c-gaussian" value="0" step="any" />
							</div>
						</div>

						<div style="display: flex; gap: 6px;">
							<button class="fit-button" onclick="fitAdvancedCurve()"
								title="Fit an advanced curve using the chosen parameters">Fit Curve</button>
							<button class="clear-fit-button" onclick="clearFittedCurve()"
								title="Remove the current fitted curve">Clear Fit</button>
						</div>
					</div>
				</div>
			</div>
		</div><!-- end input-section -->

		<!-- Graph section -->
		<div class="graph-section">
			<h2>Graph</h2>
			<div class="graph-title-container">
				<label for="graph-title">Title:</label>
				<input type="text" id="graph-title" placeholder="Enter graph title"
					oninput="debouncedUpdatePlotAndRenderLatex()">
			</div>
			<div id="plot"></div>

			<div class="result">
				<h3>Fitting Result</h3>
				<p id="fit-equation" style="display: none;"></p>
				<p id="r-squared-container" style="display: none;"></p>
			</div>

			<div class="plot-all-container">
				<button class="plot-all-btn" onclick="plotAllDatasets()"
					title="Plot all datasets together in a combined view">Plot ALL Datasets</button>
			</div>
		</div><!-- end graph-section -->
	</div><!-- end container -->

	<!-- Transparent background for the popup -->
	<div id="popup-background" style="display: none;"></div>

		<div id="popup-container" style="display: none;">
			<div id="popup-content" role="dialog" aria-modal="true" aria-labelledby="popup-title">
			<button id="popup-close" onclick="closePopup()" title="Close the combined plot window">Close</button>
			<div id="popup-title">Combined Plot of All Datasets</div>
			<div id="popup-plot-container">
				<div id="popup-plot"></div>
			</div>
			<div id="combined-plot-controls" class="combined-plot-controls">
				<div class="control-row-horizontal">
					<label for="combined-title">Title:</label>
					<input type="text" id="combined-title" placeholder="Enter a new Title here" />
				</div>
				<div class="control-row-horizontal">
					<label for="combined-x-label">x-axis Label:</label>
					<input type="text" id="combined-x-label" placeholder="Enter a new x-axis label here" />
				</div>
				<div class="control-row-horizontal">
					<label for="combined-y-label">y-axis Label:</label>
					<input type="text" id="combined-y-label" placeholder="Enter a new y-axis label here" />
				</div>
			</div>
		</div>
	</div>

	<!-- View Table Popup -->
	<div id="export-table-background" style="display: none;"></div>
		<div id="export-table-container" style="display: none;">
			<div id="export-table-content" role="dialog" aria-modal="true" aria-labelledby="export-table-title">
			<button id="export-table-close" onclick="closeExportTablePopup()"
				title="Close the view table window">Close</button>
			<div id="export-table-title">View Table</div>
			<p id="export-table-hint">Hover or tap the table to copy</p>
			<div id="export-table-rendered"></div>
		</div>
	</div>

	<!-- Filename Prompt Modal -->
	<div id="filename-prompt-background" style="display: none;"></div>
		<div id="filename-prompt-container" style="display: none;">
			<div id="filename-prompt-content" role="dialog" aria-modal="true" aria-labelledby="filename-prompt-title">
			<div id="filename-prompt-title">Enter Filename</div>
			<div id="filename-prompt-input-row">
				<input type="text" id="filename-prompt-input" placeholder="data" />
				<span id="filename-prompt-extension">.csv</span>
			</div>
			<div id="filename-prompt-buttons">
				<button id="filename-prompt-cancel" onclick="closeFilenamePrompt()">Cancel</button>
				<button id="filename-prompt-save" onclick="confirmFilename()">Save</button>
			</div>
		</div>
	</div>

	<!-- Data Processing Popup -->
	<div id="data-processing-background" style="display: none;"></div>
	<div id="data-processing-container" style="display: none;">
		<div id="data-processing-content" role="dialog" aria-modal="true" aria-labelledby="data-processing-title">
			<button id="data-processing-close" type="button" title="Close the data processing window">Close</button>
			<div id="data-processing-title">Data Processing</div>
			<p id="data-processing-subtitle">
				Source: current dataset only (x and y columns). Uncertainties are not included in this step.
			</p>

			<div class="data-processing-section">
				<div class="data-processing-heading" id="data-processing-source-heading">Source Data - Dataset 1</div>
				<p id="data-processing-source-empty" style="display: none;">
					No valid x-y rows found in this dataset. Add data first.
				</p>
				<div id="data-processing-source-table-wrap">
					<table id="data-processing-source-table">
						<thead>
							<tr id="data-processing-source-header-row">
								<th id="data-processing-source-x-header">x</th>
								<th id="data-processing-source-y-header">y</th>
							</tr>
						</thead>
						<tbody id="data-processing-source-body"></tbody>
					</table>
				</div>
			</div>

			<div class="data-processing-section">
				<div class="data-processing-heading">Column Processing</div>
				<div class="data-processing-process-actions">
					<button id="data-processing-process-x" type="button">Process x</button>
					<button id="data-processing-process-y" type="button">Process y</button>
				</div>
				<div id="data-processing-formula-panel" style="display: none;">
					<label id="data-processing-formula-label" for="data-processing-formula-input">Formula for x</label>
					<input id="data-processing-formula-input" type="text" placeholder="e.g. =1/x" autocomplete="off" />
					<p id="data-processing-formula-helper">
						e.g. =1/x
					</p>
					<div id="data-processing-formula-message" aria-live="polite" style="display: none;"></div>
					<div class="data-processing-inline-actions">
						<button id="data-processing-apply" type="button">Apply</button>
						<button id="data-processing-cancel" type="button">Cancel</button>
					</div>
				</div>
			</div>

			<div class="data-processing-section">
				<div class="data-processing-heading">Processed Columns</div>
				<p id="data-processing-derived-empty">No processed columns created yet.</p>
				<div id="data-processing-derived-list"></div>
			</div>

			<div class="data-processing-section">
				<div class="data-processing-heading">Output Mapping</div>
				<div class="data-processing-mapping-grid">
					<label for="data-processing-output-x">New X column</label>
					<select id="data-processing-output-x"></select>

					<label for="data-processing-output-y">New Y column</label>
					<select id="data-processing-output-y"></select>

					<label for="data-processing-target">Target dataset</label>
					<select id="data-processing-target"></select>
				</div>
				<div id="data-processing-message" aria-live="polite"></div>
				<div class="data-processing-footer-actions">
					<button id="data-processing-copy" type="button">Copy to Dataset</button>
					<button id="data-processing-reset" type="button">Reset</button>
				</div>
			</div>
		</div>
	</div>

	<footer>
		&copy; <a href="https://panphy.github.io/" target="_blank" rel="noopener noreferrer">PanPhy Labs</a> |
		<a href="https://buymeacoffee.com/panphy" target="_blank" rel="noopener noreferrer">Support My Projects</a>
	</footer>

	<!--
		PanPhyPlot file structure:
		- /tools/panphyplot/css/panphyplot.css (styles)
		- /tools/panphyplot/js/state.js (shared state)
		- /tools/panphyplot/js/latex-rendering.js (LaTeX helpers)
		- /tools/panphyplot/js/plotting.js (Plotly rendering)
		- /tools/panphyplot/js/curve-fitting.js (fit logic)
		- /tools/panphyplot/js/ui.js (UI + table/data handling)
		- /tools/panphyplot/js/main.js (bootstrap)
	-->
	<script src="/tools/panphyplot/js/state.js"></script>
	<script src="/tools/panphyplot/js/latex-rendering.js"></script>
	<script src="/tools/panphyplot/js/plotting.js"></script>
	<script src="/tools/panphyplot/js/curve-fitting.js"></script>
	<script src="/tools/panphyplot/js/ui.js"></script>
	<script src="/tools/panphyplot/js/data-processing.js"></script>
	<script src="/tools/panphyplot/js/main.js"></script>
</body>



</html>
