<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lesson Planner</title>
  <link rel="icon" type="image/png" href="/favicon.png">
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- FullCalendar CSS -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet" />
  <style>
    :root {
      --navbar-bg-color: #343a40;
      --navbar-title-font-size: 1.5rem;
      --navbar-title-color: #ffffff;
      --body-font-size: 0.9rem;
      --body-bg-color: #f8f9fa;
      --banner-margin: 0;
      --table-header-bg: #e9ecef;
    }

    /* Ensure the navbar stays fixed at the top */
    .navbar.fixed-top {
      position: fixed;
      top: 0;
      width: 100%;
      z-index: 1030;
    }

    /* Add enough padding-top so content isn't hidden behind the fixed navbar */
    body {
      padding-top: 70px;
      font-size: var(--body-font-size);
      background-color: var(--body-bg-color);
    }

    .hidden {
      display: none;
    }

    .navbar {
      background-color: var(--navbar-bg-color) !important;
      margin: var(--banner-margin);
    }

    /* Absolutely center the title in the navbar */
    .navbar-text.center-title {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      font-family: Helvetica, sans-serif;
      font-size: var(--navbar-title-font-size);
      color: var(--navbar-title-color);
    }

    #calendar {
      max-width: 900px;
      margin: 0 auto;
    }

    .fc-button-group .fc-button {
      flex: 1 1 auto;
      text-align: center;
    }

    /* Disable FullCalendar's default event time display */
    .fc .fc-event-time {
      display: none;
    }

    /* Hover effect for calendar events */
    .fc-event:hover {
      opacity: 0.8;
      cursor: pointer;
    }

    table colgroup col.note-col {
      width: 30%;
    }

    table colgroup col.other-col {
      width: 14%;
    }

    #lessonTableBody tr {
      cursor: pointer;
    }

    footer {
      position: static;
      font-size: 15px;
      text-align: center;
      padding: 7px;
      background: transparent;
      color: #555;
      margin: 4px 0;
      width: 100%;
    }

    footer a {
      color: #ff5f1f;
      text-decoration: none;
    }

    footer a:hover {
      text-decoration: underline;
    }

    footer a:visited {
      color: #ff5f1f;
    }

    /* Preserve line breaks in note content */
    .note-display {
      white-space: pre-line;
    }

    /* Override Bootstrap tooltip styles so that tooltip text is left-aligned and preserves line breaks */
    .tooltip-inner {
      text-align: left;
      white-space: pre-line;
    }
  </style>
</head>

<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
    <div class="container-fluid">
      <a class="navbar-brand" href="https://panphy.github.io/">
        <img src="/favicon.png" alt="PanPhy logo" style="height:35px;" />
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <div class="btn-group me-auto" role="group">
          <button type="button" class="btn btn-secondary" id="navCalendar">Calendar</button>
          <button type="button" class="btn btn-secondary" id="navList">List</button>
        </div>
        <span class="navbar-text center-title">Lesson Planner</span>
        <div class="d-flex">
          <button class="btn btn-primary me-2" id="saveCSVBtn">Backup</button>
          <button class="btn btn-secondary me-2" id="importCSVBtn">Import Backup</button>
          <input type="file" id="csvFileInput" accept=".csv" style="display: none">
          <button class="btn btn-success" id="addLessonBtn" data-bs-toggle="modal" data-bs-target="#lessonModal">Add
            Lesson</button>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="container">
    <div id="calendarView">
      <div id="calendar"></div>
    </div>
    <div id="listView" class="hidden">
      <h3 class="mt-4">Lesson List</h3>
      <div class="row mb-3">
        <div class="col-md-2">
          <input type="text" id="filterSubject" class="form-control" placeholder="Filter by Subject">
        </div>
        <div class="col-md-2">
          <input type="text" id="filterClass" class="form-control" placeholder="Filter by Class">
        </div>
        <div class="col-md-2">
          <input type="number" id="filterLesson" class="form-control" placeholder="Filter by Lesson #">
        </div>
        <div class="col-md-2">
          <input type="date" id="filterDate" class="form-control" placeholder="Filter by Date">
        </div>
        <div class="col-md-2">
          <input type="time" id="filterTime" class="form-control" placeholder="Filter by Time">
        </div>
        <div class="col-md-2">
          <select id="sortField" class="form-select">
            <option value="">Sort by...</option>
            <option value="subject">Subject</option>
            <option value="className">Class</option>
            <option value="lessonNumber">Lesson #</option>
            <option value="date">Date</option>
            <option value="time">Time</option>
          </select>
        </div>
      </div>
      <table class="table table-striped">
        <colgroup>
          <col class="other-col">
          <col class="other-col">
          <col class="other-col">
          <col class="other-col">
          <col class="other-col">
          <col class="note-col">
        </colgroup>
        <thead style="background-color: var(--table-header-bg);">
          <tr>
            <th>Subject</th>
            <th>Class</th>
            <th>Lesson #</th>
            <th>Date</th>
            <th>Time</th>
            <th>Note</th>
          </tr>
        </thead>
        <tbody id="lessonTableBody"></tbody>
      </table>
    </div>
  </div>

  <!-- Add/Edit Lesson Modal -->
  <div class="modal fade" id="lessonModal" tabindex="-1" aria-labelledby="lessonModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <form id="lessonForm">
          <div class="modal-header">
            <h5 class="modal-title" id="lessonModalLabel">Add New Lesson</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="subjectInput" class="form-label">Subject</label>
              <input type="text" class="form-control" id="subjectInput" required>
            </div>
            <div class="mb-3">
              <label for="classNameInput" class="form-label">Class Name</label>
              <input type="text" class="form-control" id="classNameInput" required>
            </div>
            <div class="mb-3">
              <label for="lessonNumberInput" class="form-label">Lesson #</label>
              <input type="number" class="form-control" id="lessonNumberInput" required>
            </div>
            <div class="mb-3">
              <label for="colorInput" class="form-label">Class Color</label>
              <input type="color" class="form-control form-control-color" id="colorInput" value="#3788d8"
                title="Choose your color">
            </div>
            <div class="mb-3">
              <label for="dateInput" class="form-label">Date (optional)</label>
              <input type="date" class="form-control" id="dateInput">
            </div>
            <div class="mb-3">
              <label for="timeInput" class="form-label">Time (optional)</label>
              <input type="time" class="form-control" id="timeInput">
            </div>
            <div class="mb-3">
              <label for="noteInput" class="form-label">Note</label>
              <textarea class="form-control" id="noteInput" rows="3"></textarea>
            </div>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-primary">Save Lesson</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Lesson Details Modal -->
  <div class="modal fade" id="detailModal" tabindex="-1" aria-labelledby="detailModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="detailModalLabel">Lesson Details</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="detailModalBody"></div>
        <div class="modal-footer">
          <button type="button" class="btn btn-warning" id="editLessonBtn">Edit</button>
          <button type="button" class="btn btn-danger" id="deleteLessonBtn">Delete</button>
        </div>
      </div>
    </div>
  </div>

  <footer>
    &copy; 2025 <a href="https://panphy.github.io/">PanPhy</a> |
    <a href="https://buymeacoffee.com/panphy">Support My Projects</a>
  </footer>

  <!-- Bootstrap Bundle with Popper and FullCalendar JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
  <script>
    /********************************************************
     * HELPER FUNCTIONS
     ********************************************************/

    /**
     * removeLeadingBlankLines:
     *  Removes lines at the top that are blank/whitespace,
     *  preserving the user's actual first typed line.
     *  Also removes leftover indentation on that line if needed.
     */
    function removeLeadingBlankLines(text) {
      // Split the text into lines
      let lines = text.split(/\r?\n/);

      // 1) Remove blank lines at the top
      while (lines.length && lines[0].trim().length === 0) {
        lines.shift();
      }

      // 2) If there's a first line, remove indentation on it
      if (lines.length > 0) {
        lines[0] = lines[0].replace(/^[ \t]+/, "");
      }

      // Reassemble
      return lines.join("\n");
    }

    /**
     * formatDateYYYYMMDD:
     *   Takes a date string or empty,
     *   returns a string in YYYY-MM-DD format
     *   if valid, or "" if invalid/empty.
     */
    function formatDateYYYYMMDD(dateStr) {
      if (!dateStr) return "";
      // Attempt to parse
      const d = new Date(dateStr);
      if (isNaN(d.getTime())) {
        // It's not a valid date
        return "";
      }
      // Build YYYY-MM-DD
      const year = d.getFullYear();
      const month = String(d.getMonth() + 1).padStart(2, "0");
      const day = String(d.getDate()).padStart(2, "0");
      return `${year}-${month}-${day}`;
    }

    // Escape HTML special characters.
    function escapeHTML(str) {
      const div = document.createElement("div");
      div.innerText = str;
      return div.innerHTML;
    }

    // Converts newlines to <br>, removing leading blank lines first.
    function convertNewlines(text) {
      const cleaned = removeLeadingBlankLines(text);
      return escapeHTML(cleaned).replace(/\r?\n/g, "<br>");
    }

    // Limit to maxLines, removing leading blank lines first.
    function getLimitedText(text, maxLines) {
      const cleaned = removeLeadingBlankLines(text);
      const lines = cleaned.split(/\r?\n/);
      const limited = lines.slice(0, maxLines).map(line => escapeHTML(line));
      let result = limited.join("<br>");
      if (lines.length > maxLines) {
        result += "<br>...";
      }
      return result;
    }

    // CSV quoting/unquoting
    function csvQuote(field) {
      let safe = field.replace(/\r?\n/g, "\\n");
      safe = safe.replace(/"/g, '""');
      return `"${safe}"`;
    }

    function parseCsvLine(line) {
      const result = [];
      let cur = "";
      let inQuotes = false;
      for (let i = 0; i < line.length; i++) {
        const c = line[i];
        if (c === '"') {
          if (!inQuotes) {
            inQuotes = true;
          } else {
            if (i + 1 < line.length && line[i + 1] === '"') {
              cur += '"';
              i++;
            } else {
              inQuotes = false;
            }
          }
        } else if (c === "," && !inQuotes) {
          result.push(cur);
          cur = "";
        } else {
          cur += c;
        }
      }
      result.push(cur);
      return result;
    }

    function csvFieldToText(field) {
      const trimmed = field.trim();
      return trimmed.replace(/\\n/g, "\n");
    }

    /********************************************************
     * APP DATA
     ********************************************************/
    let lessons = [];
    let calendar;
    let currentLessonId = null;
    let editingLessonId = null;

    function findLessonById(id) {
      return lessons.find(lesson => lesson.id == id);
    }

    /********************************************************
     * DISPLAYING LESSON DETAILS, ETC.
     ********************************************************/
    function showLessonDetail(lesson) {
      currentLessonId = lesson.id;
      // Format date in YYYY-MM-DD
      const dateString = formatDateYYYYMMDD(lesson.date);
      // If time is set, just use it as typed or from the input
      const content = `
        <p><strong>Subject:</strong> ${escapeHTML(lesson.subject)}</p>
        <p><strong>Class Name:</strong> ${escapeHTML(lesson.className)}</p>
        <p><strong>Lesson #:</strong> ${escapeHTML(lesson.lessonNumber)}</p>
        ${dateString ? `<p><strong>Date:</strong> ${dateString}</p>` : ""}
        ${lesson.time ? `<p><strong>Time:</strong> ${escapeHTML(lesson.time)}</p>` : ""}
        <p><strong>Note:</strong></p>
        <div class="note-display">${convertNewlines(lesson.note)}</div>
        <p><strong>Class Color:</strong>
          <span style="display:inline-block;width:15px;height:15px;background-color:${lesson.color};"></span>
        </p>
      `;
      document.getElementById("detailModalBody").innerHTML = content;
      new bootstrap.Modal(document.getElementById("detailModal")).show();
    }

    function saveLessonsToLocalStorage() {
      localStorage.setItem("lessons", JSON.stringify(lessons));
    }

    function loadLessonsFromLocalStorage() {
      const savedData = localStorage.getItem("lessons");
      if (savedData) {
        lessons = JSON.parse(savedData);
        refreshCalendar();
        renderListView();
      }
    }

    /********************************************************
     * MAIN START
     ********************************************************/
    document.addEventListener("DOMContentLoaded", function () {
      // Initialize FullCalendar
      calendar = new FullCalendar.Calendar(document.getElementById("calendar"), {
        initialView: "dayGridMonth",
        firstDay: 1,
        headerToolbar: {
          left: "prev,next today",
          center: "title",
          right: "dayGridMonth,timeGridWeek,timeGridDay"
        },
        displayEventTime: false,
        events: [],
        eventDidMount: function (info) {
          info.el.style.backgroundColor = "var(--body-bg-color)";
          info.el.style.borderColor = info.event.extendedProps.color;
          info.el.style.color = info.event.extendedProps.color;
        },
        eventClick: function (info) {
          showLessonDetail(info.event.extendedProps);
        }
      });
      calendar.render();

      // Nav event
      document.getElementById("navCalendar").addEventListener("click", function (e) {
        e.preventDefault();
        document.getElementById("calendarView").classList.remove("hidden");
        document.getElementById("listView").classList.add("hidden");
        this.classList.add("active");
        document.getElementById("navList").classList.remove("active");
        calendar.updateSize();
      });

      document.getElementById("navList").addEventListener("click", function (e) {
        e.preventDefault();
        document.getElementById("listView").classList.remove("hidden");
        document.getElementById("calendarView").classList.add("hidden");
        this.classList.add("active");
        document.getElementById("navCalendar").classList.remove("active");
        renderListView();
      });

      // Add/Edit Lesson
      document.getElementById("lessonForm").addEventListener("submit", function (e) {
        e.preventDefault();
        const lessonData = {
          subject: document.getElementById("subjectInput").value.trim(),
          className: document.getElementById("classNameInput").value.trim(),
          lessonNumber: document.getElementById("lessonNumberInput").value.trim(),
          color: document.getElementById("colorInput").value,
          date: document.getElementById("dateInput").value,
          time: document.getElementById("timeInput").value,
          note: document.getElementById("noteInput").value
        };
        if (editingLessonId) {
          const index = lessons.findIndex(lesson => lesson.id == editingLessonId);
          if (index !== -1) {
            lessons[index] = { id: editingLessonId, ...lessonData };
          }
          editingLessonId = null;
        } else {
          lessonData.id = Date.now();
          lessons.push(lessonData);
        }
        refreshCalendar();
        renderListView();
        saveLessonsToLocalStorage();
        this.reset();
        bootstrap.Modal.getInstance(document.getElementById("lessonModal")).hide();
      });

      // Backup, Import
      document.getElementById("saveCSVBtn").addEventListener("click", saveAsCSV);
      document.getElementById("importCSVBtn").addEventListener("click", function () {
        document.getElementById("csvFileInput").click();
      });
      document.getElementById("csvFileInput").addEventListener("change", importCSV);

      // Edit, Delete in detail
      document.getElementById("editLessonBtn").addEventListener("click", function () {
        const lesson = findLessonById(currentLessonId);
        if (lesson) {
          document.getElementById("subjectInput").value = lesson.subject;
          document.getElementById("classNameInput").value = lesson.className;
          document.getElementById("lessonNumberInput").value = lesson.lessonNumber;
          document.getElementById("colorInput").value = lesson.color;
          document.getElementById("dateInput").value = lesson.date;
          document.getElementById("timeInput").value = lesson.time;
          document.getElementById("noteInput").value = lesson.note;
          editingLessonId = lesson.id;
          const detailModal = bootstrap.Modal.getInstance(document.getElementById("detailModal"));
          if (detailModal) {
            detailModal.hide();
          }
          new bootstrap.Modal(document.getElementById("lessonModal")).show();
        }
      });

      document.getElementById("deleteLessonBtn").addEventListener("click", function () {
        if (confirm("Are you sure you want to delete this lesson?")) {
          lessons = lessons.filter(lesson => lesson.id != currentLessonId);
          refreshCalendar();
          renderListView();
          saveLessonsToLocalStorage();
          bootstrap.Modal.getInstance(document.getElementById("detailModal")).hide();
        }
      });

      // Filtering & Sorting
      document.getElementById("filterSubject").addEventListener("input", renderListView);
      document.getElementById("filterClass").addEventListener("input", renderListView);
      document.getElementById("filterLesson").addEventListener("input", renderListView);
      document.getElementById("filterDate").addEventListener("input", renderListView);
      document.getElementById("filterTime").addEventListener("input", renderListView);
      document.getElementById("sortField").addEventListener("change", renderListView);

      // Load from local storage
      loadLessonsFromLocalStorage();
    });

    function addLessonToCalendar(lesson) {
      if (!lesson.date) return;
      // Force date in the calendar events to be consistent: we store internally as YYYY-MM-DD
      const dateString = formatDateYYYYMMDD(lesson.date);
      const eventData = {
        title: lesson.time ? lesson.time + " " + lesson.className : lesson.className,
        start: lesson.time ? dateString + "T" + lesson.time : dateString,
        allDay: lesson.time ? false : true,
        extendedProps: lesson,
        backgroundColor: "var(--body-bg-color)",
        borderColor: lesson.color,
        textColor: lesson.color
      };
      calendar.addEvent(eventData);
    }

    function refreshCalendar() {
      calendar.removeAllEvents();
      lessons.forEach(lesson => addLessonToCalendar(lesson));
    }

    /**
     * Render the lessons in the list view.
     * We remove leading blank lines from the note, 
     * and format the date always as YYYY-MM-DD when displayed.
     */
    function renderListView() {
      const filterSubject = document.getElementById("filterSubject").value.trim().toLowerCase();
      const filterClass = document.getElementById("filterClass").value.trim().toLowerCase();
      const filterLesson = document.getElementById("filterLesson").value.trim();
      const filterDate = document.getElementById("filterDate").value;
      const filterTime = document.getElementById("filterTime").value;
      const sortField = document.getElementById("sortField").value;

      let filteredLessons = lessons.filter(lesson => {
        return (
          (filterSubject === "" ||
            lesson.subject.toLowerCase().includes(filterSubject)) &&
          (filterClass === "" ||
            lesson.className.toLowerCase().includes(filterClass)) &&
          (filterLesson === "" ||
            lesson.lessonNumber.toString() === filterLesson) &&
          (filterDate === "" || lesson.date === filterDate) &&
          (filterTime === "" || lesson.time === filterTime)
        );
      });

      if (sortField) {
        filteredLessons.sort((a, b) => {
          if (sortField === "lessonNumber") {
            return parseInt(a[sortField]) - parseInt(b[sortField]);
          }
          return a[sortField].localeCompare(b[sortField]);
        });
      }

      const tbody = document.getElementById("lessonTableBody");
      tbody.innerHTML = "";
      filteredLessons.forEach(lesson => {
        // Force date for display in list
        const dateOut = formatDateYYYYMMDD(lesson.date);
        // Show only the first 2 lines of the note
        const displayNote = getLimitedText(lesson.note, 2);
        // Up to 10 lines in the tooltip
        const tooltipNote = getLimitedText(lesson.note, 10);

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>
            <span style="display:inline-block;width:15px;height:15px;background-color:${lesson.color};margin-right:5px;"></span>
            ${escapeHTML(lesson.subject)}
          </td>
          <td>${escapeHTML(lesson.className)}</td>
          <td>${escapeHTML(lesson.lessonNumber)}</td>
          <td>${escapeHTML(dateOut)}</td>
          <td>${escapeHTML(lesson.time || "")}</td>
          <td>
            <span
              class="note-display"
              data-bs-toggle="tooltip"
              data-bs-html="true"
              data-bs-placement="top"
              data-bs-trigger="hover focus"
              onclick="event.stopPropagation();"
              title="${tooltipNote}"
            >
              ${displayNote}
            </span>
          </td>
        `;
        tr.addEventListener("click", function () {
          showLessonDetail(lesson);
        });
        tbody.appendChild(tr);
      });

      // Initialize tooltips
      const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
      tooltipTriggerList.forEach(function (tooltipTriggerEl) {
        new bootstrap.Tooltip(tooltipTriggerEl);
      });
    }

    /********************************************************
     * CSV EXPORT & IMPORT
     ********************************************************/
    async function saveCSVFile(csvContent, suggestedFileName = "lessons_backup.csv") {
      if (window.showSaveFilePicker) {
        try {
          const options = {
            suggestedName: suggestedFileName,
            types: [
              {
                description: "CSV Files",
                accept: { "text/csv": [".csv"] }
              }
            ]
          };
          const handle = await window.showSaveFilePicker(options);
          const writable = await handle.createWritable();
          await writable.write(csvContent);
          await writable.close();
        } catch (err) {
          console.error("Save cancelled or failed", err);
        }
      } else {
        const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
        const url = URL.createObjectURL(blob);
        const link = document.createElement("a");
        link.setAttribute("href", url);
        link.setAttribute("download", suggestedFileName);
        link.style.visibility = "hidden";
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }
    }

    function saveAsCSV() {
      if (lessons.length === 0) {
        alert("No lessons to save!");
        return;
      }
      const header = ["Subject", "Class Name", "Lesson #", "Date", "Time", "Note", "Color"];
      const lines = [];
      // Quoted header
      lines.push(header.map(csvQuote).join(","));

      // Each row
      lessons.forEach(lesson => {
        const row = [
          csvQuote(lesson.subject),
          csvQuote(lesson.className),
          csvQuote(lesson.lessonNumber),
          csvQuote(lesson.date),
          csvQuote(lesson.time),
          csvQuote(lesson.note),
          csvQuote(lesson.color)
        ];
        lines.push(row.join(","));
      });

      const csvContent = lines.join("\n");
      saveCSVFile(csvContent, "lessons_backup.csv");
    }

    function importCSV(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function (e) {
        parseCSV(e.target.result);
      };
      reader.readAsText(file);
      event.target.value = "";
    }

    function parseCSV(text) {
      const lines = text.trim().split("\n");
      if (lines.length < 2) {
        alert("CSV file does not contain valid data.");
        return;
      }
      const newLessons = [];
      for (let i = 1; i < lines.length; i++) {
        const rawLine = lines[i];
        const fields = parseCsvLine(rawLine);
        if (fields.length < 7) {
          continue;
        }
        const lesson = {
          subject: csvFieldToText(fields[0]),
          className: csvFieldToText(fields[1]),
          lessonNumber: csvFieldToText(fields[2]),
          date: csvFieldToText(fields[3]),
          time: csvFieldToText(fields[4]),
          note: csvFieldToText(fields[5]),
          color: csvFieldToText(fields[6])
        };
        lesson.id = Date.now() + i;
        newLessons.push(lesson);
      }
      lessons = newLessons;
      refreshCalendar();
      renderListView();
      saveLessonsToLocalStorage();
    }
  </script>
</body>

</html>