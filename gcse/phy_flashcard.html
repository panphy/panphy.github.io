<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Physics Flashcards — Landing</title>
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <style>
        /* --- Background (no cut-off) --- */
        html,
        body {
            height: 100%;
        }

        body {
            margin: 0;
            color: #e6edf3;
            font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
            line-height: 1.45;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background:
                radial-gradient(1200px 800px at 20% -10%, #0ea5e9 0%, rgba(14, 165, 233, 0) 60%),
                radial-gradient(1000px 700px at 120% 20%, #22c55e 0%, rgba(34, 197, 94, 0) 50%),
                linear-gradient(180deg, #0b1220 0%, #0a0f1a 60%, #0a0f19 100%);
            min-height: 100svh;
            /* covers large windows too */
            background-attachment: fixed, fixed, fixed;
            /* keep gradients pinned */
        }

        .wrap {
            max-width: 1200px;
            margin: 32px auto 64px;
            padding: 0 20px;
        }

        header.brand {
            display: flex;
            align-items: center;
            gap: 14px;
            margin-bottom: 20px;
        }

        .logo {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: linear-gradient(135deg, #60a5fa, #34d399);
            box-shadow: 0 10px 25px rgba(52, 211, 153, .25), inset 0 0 14px rgba(255, 255, 255, .35);
        }

        .brand h1 {
            margin: 0;
            font-size: 22px;
            font-weight: 700;
            letter-spacing: .2px;
        }

        .crumbs {
            opacity: .7;
            font-size: 13px;
            margin-left: auto;
        }

        .panel-grid {
            display: grid;
            grid-template-columns: 1.2fr 1fr;
            gap: 18px;
        }

        @media (max-width: 1000px) {
            .panel-grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: rgba(255, 255, 255, .04);
            border: 1px solid rgba(255, 255, 255, .08);
            border-radius: 16px;
            padding: 18px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, .18);
            backdrop-filter: blur(6px);
        }

        .card h3 {
            margin: 0 0 12px;
            font-size: 14px;
            letter-spacing: .06em;
            text-transform: uppercase;
            color: #93a4b8;
        }

        /* filter lines stack items vertically (one per line) */
        .filter-block {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .line-item {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, .03);
            border: 1px solid rgba(255, 255, 255, .06);
            border-radius: 12px;
            padding: 10px 12px;
        }

        .line-item input[type="checkbox"] {
            accent-color: #22c55e;
            width: 18px;
            height: 18px;
        }

        .line-item label {
            cursor: pointer;
            display: inline-block;
        }

        .hint {
            color: #93a4b8;
            font-size: 12px;
            margin-top: 8px;
            opacity: .85;
        }

        .controls-row {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 6px 0 10px;
            flex-wrap: wrap;
        }

        .searchbar {
            position: relative;
            flex: 1 1 360px;
            max-width: 650px;
        }

        .searchbar input {
            width: 100%;
            padding: 12px 14px 12px 42px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, .12);
            background: rgba(8, 12, 20, .6);
            color: #e6edf3;
            outline: none;
        }

        .searchbar svg {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            opacity: .6;
        }

        /* toggle switch */
        .switch {
            position: relative;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .switch input {
            display: none;
        }

        .slider {
            width: 48px;
            height: 28px;
            border-radius: 999px;
            background: rgba(255, 255, 255, .15);
            border: 1px solid rgba(255, 255, 255, .1);
            position: relative;
            transition: .25s ease;
        }

        .slider::after {
            content: "";
            position: absolute;
            top: 50%;
            left: 4px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            transform: translateY(-50%);
            box-shadow: 0 4px 14px rgba(0, 0, 0, .35);
            transition: .25s ease;
        }

        .switch input:checked+.slider {
            background: linear-gradient(135deg, #60a5fa, #34d399);
        }

        .switch input:checked+.slider::after {
            left: 24px;
        }

        .summary {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 12px;
            align-items: start;
        }

        .summary pre {
            margin: 0;
            white-space: pre-wrap;
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            background: rgba(255, 255, 255, .03);
            border: 1px solid rgba(255, 255, 255, .06);
            border-radius: 12px;
            padding: 12px;
            font-size: 13px;
            color: #b8c6d6;
        }

        .btn {
            border: none;
            cursor: pointer;
            border-radius: 14px;
            padding: 12px 16px;
            font-weight: 600;
            background: linear-gradient(135deg, #60a5fa, #34d399);
            color: #07121f;
            box-shadow: 0 10px 24px rgba(96, 165, 250, .25), 0 8px 20px rgba(52, 211, 153, .18);
        }

        .btn:disabled {
            opacity: .6;
            cursor: not-allowed;
        }

        /* --- Flashcard view --- */
        .stage {
            margin-top: 18px;
            display: none;
        }

        .stage.active {
            display: block;
        }

        .fc-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .counter {
            opacity: .8;
            font-size: 14px;
        }

        .deck {
            perspective: 1200px;
            max-width: 860px;
            margin: 0 auto 14px;
        }

        .flashcard {
            position: relative;
            width: 100%;
            min-height: 200px;
            background: transparent;
            border: none;
            cursor: pointer;
        }

        .flip {
            position: relative;
            transform-style: preserve-3d;
            transition: transform .6s cubic-bezier(.2, .8, .2, 1);
        }

        .card-face {
            border-radius: 16px;
            background: rgba(255, 255, 255, .05);
            border: 1px solid rgba(255, 255, 255, .08);
            padding: 22px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, .22);
            backdrop-filter: blur(6px);
            min-height: 220px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            line-height: 1.6;
            position: absolute;
            inset: 0;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
        }

        .back {
            transform: rotateY(180deg);
        }

        .flipped .flip {
            transform: rotateY(180deg);
        }

        .fc-meta {
            text-align: center;
            margin: 8px 0 2px;
            color: #9eb1c7;
            font-size: 13px;
        }

        .nav {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 8px;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, .06);
            color: #e6edf3;
            border: 1px solid rgba(255, 255, 255, .12);
        }

        .btn-wide {
            min-width: 120px;
        }

        .footer-pad {
            height: 32px;
        }

        /* ensure no cut-off look near the end */

        a.source {
            color: #9acdff;
            text-decoration: none;
            border-bottom: 1px dashed rgba(154, 205, 255, .6);
        }
    </style>
</head>

<body>
    <div class="wrap">
        <header class="brand">
            <div class="logo" aria-hidden="true"></div>
            <h1>Physics Flashcards</h1>
            <div class="crumbs">Landing • Select content → Start</div>
        </header>

        <div class="panel-grid">
            <!-- Left: Paper + Search + Chapters -->
            <div class="card">
                <h3>Choose Paper(s)</h3>
                <div class="controls-row">
                    <label class="line-item" style="width:max-content">
                        <input type="checkbox" name="paper" value="Paper 1" />
                        <label>Paper 1</label>
                    </label>
                    <label class="line-item" style="width:max-content">
                        <input type="checkbox" name="paper" value="Paper 2" />
                        <label>Paper 2</label>
                    </label>

                    <label class="switch" title="Shuffle cards">
                        <input id="shuffleToggle" type="checkbox" />
                        <span class="slider" aria-hidden="true"></span>
                        <span>Shuffle</span>
                    </label>

                    <div class="searchbar">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <circle cx="11" cy="11" r="8" stroke-width="2" />
                            <line x1="21" y1="21" x2="16.65" y2="16.65" stroke-width="2" />
                        </svg>
                        <input id="search" placeholder="Search questions..." />
                    </div>
                </div>

                <h3 style="margin-top:18px">Choose Chapter(s)</h3>
                <div id="chapters" class="filter-block" aria-live="polite"></div>
                <div class="hint">Tip: click items to toggle; each chapter is shown on its own line.</div>
            </div>

            <!-- Right: Topics + Summary -->
            <div class="card">
                <h3>Choose Topic Number(s)</h3>
                <div id="topics" class="filter-block" aria-live="polite"></div>

                <div class="card" style="margin-top:14px">
                    <h3>Live Summary</h3>
                    <div class="summary">
                        <pre id="summaryText">Paper: All
Topic(s):
—
Chapter(s):
— 

Search: — 

Matches: 0</pre>
                        <button id="startBtn" class="btn btn-wide" disabled>Start Revising</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Flashcard Stage -->
        <section id="stage" class="stage">
            <div class="card">
                <div class="fc-top">
                    <div class="counter" id="counter">Card 0 of 0</div>
                    <div class="counter" id="deckInfo"></div>
                </div>

                <div class="deck">
                    <button id="flashcard" class="flashcard" aria-live="polite">
                        <div class="flip">
                            <div class="card-face front" id="qText">Question</div>
                            <div class="card-face back" id="aText">Answer</div>
                        </div>
                    </button>
                </div>

                <div class="fc-meta" id="meta"></div>

                <div class="nav">
                    <button id="prev" class="btn btn-secondary">◀ Prev</button>
                    <button id="next" class="btn btn-secondary">Next ▶</button>
                </div>
            </div>
        </section>

        <div class="footer-pad"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <script>
        /* ==============================
           Data + Parsing
        ================================= */
        const state = {
            allCards: [],               // {paper, topicNo, topicName, chapterNo, chapterName, question, answer, source}
            filtered: [],
            idx: 0,
            flipped: false,
            selectedPapers: new Set(),
            selectedTopicNos: new Set(),
            selectedChapterNos: new Set(),
            shuffle: false,
            search: ''
        };

        // Try a few likely column name variants
        function normalizeRow(row) {
            const get = (...keys) => {
                for (const k of keys) {
                    if (row[k] !== undefined && row[k] !== null && String(row[k]).trim() !== '') return String(row[k]).trim();
                }
                return '';
            };
            return {
                paper: get('Paper', 'paper'),
                topicNo: get('TopicNo', 'Topic', 'Topic Number', 'Topic_Num', 'Topic_No'),
                topicName: get('TopicName', 'Topic Name', 'Topic_Title', 'Topic Title', 'Topic Label'),
                chapterNo: get('ChapterNo', 'Chapter', 'Chapter Number', 'Chapter_Num', 'Chapter_No'),
                chapterName: get('ChapterName', 'Chapter Name', 'Chapter_Title', 'Chapter Title', 'Chapter Label'),
                question: get('Question', 'Q', 'Prompt'),
                answer: get('Answer', 'A', 'Response'),
                source: get('Source', 'PDF', 'Ref', 'Reference')
            };
        }

        function loadCSV() {
            return new Promise((resolve, reject) => {
                Papa.parse('phys_ss.csv', {
                    download: true,
                    header: true,
                    skipEmptyLines: true,
                    complete: (res) => {
                        const rows = res.data.map(normalizeRow).filter(r => r.question && r.answer);
                        state.allCards = rows;
                        resolve(rows);
                    },
                    error: reject
                });
            });
        }

        /* ==============================
           UI Builders
        ================================= */
        const topicsEl = document.getElementById('topics');
        const chaptersEl = document.getElementById('chapters');
        const summaryEl = document.getElementById('summaryText');
        const startBtn = document.getElementById('startBtn');

        function uniqueSorted(arr) {
            return Array.from(new Set(arr)).sort((a, b) => {
                // numeric if possible otherwise alpha
                const na = +a, nb = +b;
                if (!isNaN(na) && !isNaN(nb)) return na - nb;
                return String(a).localeCompare(String(b));
            });
        }

        function rebuildFilters() {
            // Topics list (one per line with name)
            const topicsMap = new Map(); // topicNo -> name
            state.allCards.forEach(r => {
                const no = r.topicNo || '—';
                const nm = r.topicName || '';
                if (!topicsMap.has(no) && no !== '—') topicsMap.set(no, nm);
            });
            const topicLines = uniqueSorted([...topicsMap.keys()]);
            topicsEl.innerHTML = '';
            topicLines.forEach(no => {
                const name = topicsMap.get(no) || '';
                const id = `topic_${no}`;
                const label = `Topic ${no}${name ? ' • ' + name : ''}`;
                const line = document.createElement('label');
                line.className = 'line-item';
                line.innerHTML = `
      <input type="checkbox" id="${id}" value="${no}">
      <label for="${id}">${label}</label>
    `;
                const input = line.querySelector('input');
                input.checked = state.selectedTopicNos.has(no);
                input.addEventListener('change', () => {
                    input.checked ? state.selectedTopicNos.add(no) : state.selectedTopicNos.delete(no);
                    updateSummary();
                    applyFilters();
                });
                topicsEl.appendChild(line);
            });

            // Chapters list
            const chapMap = new Map(); // chapterNo -> name
            state.allCards.forEach(r => {
                const no = r.chapterNo || '—';
                const nm = r.chapterName || '';
                if (!chapMap.has(no) && no !== '—') chapMap.set(no, nm);
            });
            const chapLines = uniqueSorted([...chapMap.keys()]);
            chaptersEl.innerHTML = '';
            chapLines.forEach(no => {
                const name = chapMap.get(no) || '';
                const id = `chap_${no}`;
                const label = `Chapter ${no}${name ? ' • ' + name : ''}`;
                const line = document.createElement('label');
                line.className = 'line-item';
                line.innerHTML = `
      <input type="checkbox" id="${id}" value="${no}">
      <label for="${id}">${label}</label>
    `;
                const input = line.querySelector('input');
                input.checked = state.selectedChapterNos.has(no);
                input.addEventListener('change', () => {
                    input.checked ? state.selectedChapterNos.add(no) : state.selectedChapterNos.delete(no);
                    updateSummary();
                    applyFilters();
                });
                chaptersEl.appendChild(line);
            });
        }

        /* ==============================
           Filtering + Summary
        ================================= */
        function applyFilters() {
            const papers = state.selectedPapers.size ? state.selectedPapers : new Set(['Paper 1', 'Paper 2']);
            const topics = state.selectedTopicNos;
            const chaps = state.selectedChapterNos;
            const term = state.search.trim().toLowerCase();

            state.filtered = state.allCards.filter(r => {
                if (!papers.has(r.paper)) return false;
                if (topics.size && !topics.has(r.topicNo)) return false;
                if (chaps.size && !chaps.has(r.chapterNo)) return false;
                if (term) {
                    const blob = (r.question + ' ' + r.answer + ' ' + r.topicName + ' ' + r.chapterName).toLowerCase();
                    if (!blob.includes(term)) return false;
                }
                return true;
            });

            if (state.shuffle) shuffleArray(state.filtered);
            state.idx = 0;
            refreshDeckMeta();
            startBtn.disabled = state.filtered.length === 0;
        }

        function updateSummary() {
            const paperTxt = state.selectedPapers.size ? [...state.selectedPapers].join(', ') : 'All';

            // topics: each on new line
            const topicsChosen = [...state.selectedTopicNos].sort((a, b) => +a - +b).map(no => {
                const entry = state.allCards.find(r => r.topicNo === no);
                const nm = entry ? (entry.topicName || '') : '';
                return `• Topic ${no}${nm ? ' • ' + nm : ''}`;
            }).join('\n') || '—';

            // chapters: lines too
            const chaptersChosen = [...state.selectedChapterNos].sort((a, b) => +a - +b).map(no => {
                const entry = state.allCards.find(r => r.chapterNo === no);
                const nm = entry ? (entry.chapterName || '') : '';
                return `• Chapter ${no}${nm ? ' • ' + nm : ''}`;
            }).join('\n') || '—';

            const searchTxt = state.search.trim() ? state.search.trim() : '—';
            const matches = state.filtered.length ?? 0;

            summaryEl.textContent =
                `Paper: ${paperTxt}
Topic(s):
${topicsChosen}

Chapter(s):
${chaptersChosen}

Search: ${searchTxt}

Matches: ${matches}`;
        }

        /* ==============================
           Flashcards — Flip on click
        ================================= */
        const stage = document.getElementById('stage');
        const qText = document.getElementById('qText');
        const aText = document.getElementById('aText');
        const flashcardBtn = document.getElementById('flashcard');
        const counterEl = document.getElementById('counter');
        const metaEl = document.getElementById('meta');
        const deckInfoEl = document.getElementById('deckInfo');

        flashcardBtn.addEventListener('click', () => {
            state.flipped = !state.flipped;
            flashcardBtn.classList.toggle('flipped', state.flipped);
        });

        document.getElementById('prev').addEventListener('click', () => {
            if (!state.filtered.length) return;
            state.idx = (state.idx - 1 + state.filtered.length) % state.filtered.length;
            state.flipped = false;
            flashcardBtn.classList.remove('flipped');
            renderCard();
        });
        document.getElementById('next').addEventListener('click', () => {
            if (!state.filtered.length) return;
            state.idx = (state.idx + 1) % state.filtered.length;
            state.flipped = false;
            flashcardBtn.classList.remove('flipped');
            renderCard();
        });

        function renderCard() {
            const card = state.filtered[state.idx];
            if (!card) return;
            qText.textContent = card.question;
            aText.textContent = card.answer;
            counterEl.textContent = `Card ${state.idx + 1} of ${state.filtered.length}`;
            metaEl.innerHTML = `${escapeHtml(card.paper)} • Topic ${escapeHtml(card.topicNo)}${card.topicName ? ' • ' + escapeHtml(card.topicName) : ''} • Chapter ${escapeHtml(card.chapterNo)}${card.chapterName ? ' • ' + escapeHtml(card.chapterName) : ''}${card.source ? ' • <a class="source" target="_blank" href="#" onclick="return false;">' + escapeHtml(card.source) + '</a>' : ''}`;
        }

        function refreshDeckMeta() {
            deckInfoEl.textContent = state.shuffle ? 'Shuffled' : 'In order';
            updateSummary();
            renderCard();
        }

        /* ==============================
           Utilities
        ================================= */
        function escapeHtml(s) { return String(s).replace(/[&<>"']/g, m => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[m])); }
        function shuffleArray(arr) {
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
        }

        /* ==============================
           Event wiring
        ================================= */
        document.getElementById('shuffleToggle').addEventListener('change', (e) => {
            state.shuffle = e.target.checked;
            applyFilters();
        });

        document.getElementById('search').addEventListener('input', (e) => {
            state.search = e.target.value || '';
            applyFilters();
        });

        document.querySelectorAll('input[name="paper"]').forEach(cb => {
            cb.addEventListener('change', () => {
                if (cb.checked) state.selectedPapers.add(cb.value);
                else state.selectedPapers.delete(cb.value);
                updateSummary();
                applyFilters();
            });
        });

        startBtn.addEventListener('click', () => {
            stage.classList.add('active');
            window.scrollTo({ top: stage.offsetTop - 12, behavior: 'smooth' });
        });

        /* ==============================
           Boot
        ================================= */
        (async function init() {
            try {
                await loadCSV();
                rebuildFilters();
                applyFilters();
                updateSummary();
            } catch (err) {
                console.error(err);
                alert('Failed to load phys_ss.csv. Please place it next to this HTML file.');
            }
        })();
    </script>
</body>

</html>